<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡å†Œ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
            text-align: center;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        /* ä¸»é¢˜é¢œè‰²å®šä¹‰ */
        body.theme-default {
            --primary-color: #4CAF50;
            --primary-text: white;
            --secondary-color: #f5f5f5;
            --background-color: white;
            --text-color: #333;
            --border-color: #ddd;
            --button-hover: #45a049;
            --header-bg: #4CAF50;
            --header-text: white;
            --tab-bg: #ddd;
            --tab-active: #4CAF50;
            --product-bg: white;
            --record-bg: #f9f9f9;
            --points-display: #4CAF50;
        }

        body.theme-pink {
            --primary-color: #E91E63;
            --primary-text: white;
            --secondary-color: #FCE4EC;
            --background-color: white;
            --text-color: #880E4F;
            --border-color: #F8BBD0;
            --button-hover: #C2185B;
            --header-bg: #C2185B;
            --header-text: white;
            --tab-bg: #F8BBD0;
            --tab-active: #E91E63;
            --product-bg: white;
            --record-bg: #FCE4EC;
            --points-display: #E91E63;
        }

        body.theme-yellow {
            --primary-color: #FFC107;
            --primary-text: black;
            --secondary-color: #FFF9C4;
            --background-color: white;
            --text-color: #5D4037;
            --border-color: #FFE082;
            --button-hover: #FFA000;
            --header-bg: #FFA000;
            --header-text: white;
            --tab-bg: #FFE082;
            --tab-active: #FFC107;
            --product-bg: white;
            --record-bg: #FFF9C4;
            --points-display: #FFA000;
        }

        body.theme-blue {
            --primary-color: #2196F3;
            --primary-text: white;
            --secondary-color: #E3F2FD;
            --background-color: white;
            --text-color: #0D47A1;
            --border-color: #90CAF9;
            --button-hover: #1976D2;
            --header-bg: #1976D2;
            --header-text: white;
            --tab-bg: #BBDEFB;
            --tab-active: #2196F3;
            --product-bg: white;
            --record-bg: #E3F2FD;
            --points-display: #1976D2;
        }

        body.theme-dark {
            --primary-color: #424242;
            --primary-text: white;
            --secondary-color: #212121;
            --background-color: #303030;
            --text-color: #E0E0E0;
            --border-color: #616161;
            --button-hover: #212121;
            --header-bg: #212121;
            --header-text: white;
            --tab-bg: #616161;
            --tab-active: #424242;
            --product-bg: #424242;
            --record-bg: #212121;
            --points-display: #212121;
        }

        body.theme-sanrio {
            --primary-color: #FF9DB5;
            --primary-text: white;
            --secondary-color: #FFD1DC;
            --background-color: #FFF0F5;
            --text-color: #FF6B8B;
            --border-color: #FFB6C1;
            --button-hover: #FF6B8B;
            --header-bg: #FF6B8B;
            --header-text: white;
            --tab-bg: #FFD1DC;
            --tab-active: #FF9DB5;
            --product-bg: white;
            --record-bg: #FFD1DC;
            --points-display: #FF6B8B;
        }
        
        .header {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--header-bg);
            color: var(--header-text);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .coins-display {
            background: var(--points-display);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 24px;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 20px;
            min-width: 300px;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .exchange-btn {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .exchange-btn:hover {
            background: var(--button-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        /* å¡æ± é€‰æ‹©åŒºåŸŸ */
        .pool-selection {
            background-color: var(--product-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        
        .pool-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .pool-tab {
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background: var(--tab-bg);
            border-radius: 30px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .pool-tab.active {
            background: var(--tab-active);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .pool-tab:hover:not(.active) {
            background: var(--secondary-color);
        }
        
        /* SSRé€‰æ‹©åŒºåŸŸ - ç®€åŒ–ç‰ˆ */
        .ssr-selector {
            margin-top: 25px;
            padding: 20px;
            background: var(--secondary-color);
            border-radius: 12px;
            text-align: center;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        
        .ssr-select {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 30px;
            border: 2px solid var(--primary-color);
            margin-top: 15px;
            width: 85%;
            max-width: 350px;
            background-color: var(--product-bg);
            font-weight: bold;
            outline: none;
            transition: all 0.3s;
        }
        
        .ssr-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(33,150,243,0.3);
        }
        
        .selected-ssr-preview {
            margin-top: 20px;
            display: none;
        }
        
        .selected-ssr-card {
            width: 140px;
            height: 240px;
            margin: 0 auto;
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border: 3px solid #FFC107;
            overflow: hidden;
        }
        
        .selected-ssr-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .selected-ssr-name {
            margin-top: 15px;
            font-weight: bold;
            font-size: 18px;
            color: var(--text-color);
        }
        
        /* æŠ½å¡åŒºåŸŸ */
        .gacha-section {
            background-color: var(--product-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        
        .gacha-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 25px;
        }
        
        .gacha-btn {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 15px 35px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .gacha-btn:hover {
            background: var(--button-hover);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        
        .gacha-btn:disabled {
            background: linear-gradient(135deg, #cccccc 0%, #999999 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .gacha-cost {
            font-weight: bold;
            font-size: 20px;
        }
        
        /* ä¿åº•è®¡æ•°å™¨ */
        .pity-counter {
            margin-top: 25px;
            padding: 15px;
            background: var(--secondary-color);
            border-radius: 10px;
            font-size: 16px;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--product-bg);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            border: 1px solid var(--border-color);
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: sticky;
            top: 0;
            background-color: var(--product-bg);
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            z-index: 10;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: var(--text-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            color: #f44336;
            transform: rotate(90deg);
        }
        
        /* å¡å†Œæ ·å¼ */
        .album-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .album-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--tab-bg);
            border-radius: 30px;
            font-weight: bold;
        }
        
        .album-tab.active {
            background: var(--tab-active);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 18px;
            padding: 10px;
        }
        
        .album-card {
            aspect-ratio: 7/12;
            background-color: var(--secondary-color);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 2px solid var(--border-color);
        }
        
        .album-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .album-card.collected {
            background-color: var(--product-bg);
            border-color: #FFC107;
        }
        
        .album-card.collected::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,215,0,0.2) 0%, rgba(255,255,255,0) 50%);
        }
        
        .album-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .album-card .card-image-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .album-card .card-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 8px;
            font-size: 13px;
            text-align: center;
            z-index: 2;
        }
        
        .album-card .card-rarity {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            z-index: 2;
        }
        
        .unknown-card {
            font-size: 36px;
            font-weight: bold;
            color: #ccc;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* å¡å†ŒæŒ‰é’® */
        .album-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .album-btn:hover {
            background: var(--button-hover);
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        .shop-btn {
            position: fixed;
            bottom: 120px;
            right: 30px;
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .shop-btn:hover {
            background: var(--button-hover);
            transform: scale(1.15) rotate(-10deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-btn:hover {
            background: var(--button-hover);
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        /* ä¸»é¢˜é€‰æ‹©å¼¹çª— */
        .theme-options {
            position: fixed;
            bottom: 30px;
            left: 110px;
            background: var(--product-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 99;
            display: none;
            flex-direction: row;
            gap: 10px;
            align-items: center;
        }
        
        .theme-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-option:hover {
            transform: scale(1.1);
        }
        
        .theme-option.default {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .theme-option.pink {
            background: linear-gradient(135deg, #E91E63 0%, #C2185B 100%);
            color: white;
        }
        
        .theme-option.blue {
            background: linear-gradient(135deg, #2196F3 0%, #0d47a1 100%);
            color: white;
        }
        
        .theme-option.yellow {
            background: linear-gradient(135deg, #FFC107 0%, #FFA000 100%);
            color: black;
        }
        
        .theme-option.dark {
            background: linear-gradient(135deg, #424242 0%, #212121 100%);
            color: white;
        }
        
        .theme-option.sanrio {
            background: linear-gradient(135deg, #FF9DB5 0%, #FF6B8B 100%);
            color: white;
        }
        
        /* æŠ½å¡ç»“æœå¼¹çª— */
        .result-card {
            width: 175px; /* 7çš„25å€ */
            height: 300px; /* 12çš„25å€ */
            margin: 0 auto;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .result-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .result-card.ssr {
            border: 4px solid #FFD700;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        
        .result-card.sr {
            border: 4px solid #C0C0C0;
            background: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%);
        }
        
        .result-card.r {
            border: 4px solid #CD7F32;
            background: linear-gradient(135deg, #CD7F32 0%, #A0522D 100%);
        }
        
        .result-card img {
            width: 90%;
            height: 75%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .result-card .rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            font-weight: bold;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 20px;
            background-color: rgba(0,0,0,0.5);
        }
        
        .result-card .card-name {
            margin-top: 10px;
            font-weight: bold;
            font-size: 18px;
            color: #333;
            padding: 5px 10px;
            background-color: rgba(255,255,255,0.8);
            border-radius: 20px;
        }
        
        .new-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            z-index: 2;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* å•†åº—å¼¹çª— */
        .shop-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s;
            border-radius: 10px;
        }
        
        .shop-item:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .shop-item:last-child {
            border-bottom: none;
        }
        
        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .shop-item-img {
            width: 70px;
            height: 100px;
            background-color: var(--secondary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            border: 2px solid var(--border-color);
        }
        
        .shop-item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .shop-item-details {
            flex-grow: 1;
            text-align: left;
        }
        
        .shop-item-name {
            font-weight: bold;
            font-size: 18px;
            color: var(--text-color);
        }
        
        .shop-item-desc {
            font-size: 14px;
            color: var(--text-color);
            margin-top: 5px;
        }
        
        .shop-item-price {
            font-weight: bold;
            color: #FF5722;
            font-size: 18px;
            margin-right: 15px;
        }
        
        .shop-item-btn {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 8px 18px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        
        .shop-item-btn:hover:not(:disabled) {
            background: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }
        
        .shop-item-btn:disabled {
            background: linear-gradient(135deg, #cccccc 0%, #999999 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* ç§¯åˆ†å…‘æ¢è¡¨å• */
        .exchange-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .exchange-form-group {
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        
        .exchange-form-group label {
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 16px;
            color: var(--text-color);
        }
        
        .exchange-form-group input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: var(--product-bg);
            color: var(--text-color);
        }
        
        .exchange-form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(33,150,243,0.3);
            outline: none;
        }
        
        .info-text {
            font-size: 14px;
            color: var(--text-color);
            margin-top: 8px;
        }
        
        .exchange-submit {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .exchange-submit:hover {
            background: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        /* ç¿»ç‰Œæ¸¸æˆæ ·å¼ */
        .flip-game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .flip-game-level {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .flip-game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 500px;
        }
        
        .flip-card {
            aspect-ratio: 1/1;
            width: 80px;
            height: 80px;
            background: var(--primary-color);
            color: var(--primary-text);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin: 0 auto;
        }
        
        .flip-card:hover {
            background: var(--button-hover);
            transform: scale(1.05);
        }
        
        .flip-card.revealed {
            background: var(--product-bg);
            cursor: default;
            padding: 5px; 
        }
        
        .flip-card-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .flip-card img {
            width: 90%;
            height: 90%;
            object-fit: contain;
        }
        
        .flip-card-name {
            font-size: 12px;
            font-weight: bold;
            margin-top: 3px;
            color: var(--text-color);
        }
        
        .flip-game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            background: var(--secondary-color);
            border-radius: 10px;
        }
        
        .flip-game-btn {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        
        .flip-game-btn:hover {
            background: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }
        
        .flip-game-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .gacha-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .pool-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .album-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .shop-btn {
                bottom: 110px;
            }
            
            .theme-btn {
                bottom: 30px;
            }
            
            .theme-options {
                bottom: 110px;
            }
            
            .flip-game-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* è¿”å›ä¸»é¡µæŒ‰é’®ï¼ˆç°åœ¨ç”¨ä½œé‡‘å¸æŒ‰é’®ï¼‰ */
        .home-btn {
            position: fixed;
            bottom: 120px;
            left: 30px;
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover {
            background: var(--button-hover);
            transform: scale(1.15) rotate(-10deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        /* ä¸‰ä¸½é¸¥è§£é”æç¤º */
        .sanrio-lock {
            position: relative;
            opacity: 0.5;
        }
        
        .sanrio-lock::after {
            content: "88ç¢ç‰‡è§£é”";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 2;
        }
    </style>
</head>
<body class="theme-default">
    <div class="header">
        <h1>ğŸ´ å¡ç‰‡æ”¶é›†</h1>
        <p>æ”¶é›†ç¨€æœ‰å¡ç‰‡ï¼Œå®Œæˆä½ çš„ä¸“å±æ”¶è—ï¼(å®Œæˆä¸€ä¸ªä¸»é¢˜æœ€é«˜å¯å¾—30ä»¥ä¸‹çš„ç©å…·ä¸€ä¸ªå“¦ï¼‰</p>
    </div>
    
    <div class="coins-display">
        <span>å½“å‰é‡‘å¸: <span id="current-coins">5000</span></span>
        <button class="exchange-btn" onclick="openExchangeModal()">ç§¯åˆ†å…‘æ¢</button>
    </div>
    
    <!-- å¡æ± é€‰æ‹©åŒºåŸŸ -->
    <div class="pool-selection">
        <h2>é€‰æ‹©å¡æ± </h2>
        <div class="pool-tabs">
            <div class="pool-tab active" onclick="switchPool('zodiac')">å››å¤§ç¥å…½</div>
            <div class="pool-tab" onclick="switchPool('constellation')">åäºŒæ˜Ÿåº§</div>
            <div class="pool-tab" onclick="switchPool('seasons')">å››å­£é™å®š</div>
            <div class="pool-tab" id="sanrio-tab" onclick="trySwitchToSanrio()">ä¸‰ä¸½é¸¥</div>
        </div>
        
        <!-- ç®€åŒ–çš„SSRé€‰æ‹©åŒºåŸŸ -->
        <div class="ssr-selector" id="ssr-selector">
            <h3>é€‰æ‹©ç›®æ ‡SSRå¡ç‰‡</h3>
            <select class="ssr-select" id="ssr-select" onchange="selectSSR(this.value)">
                <option value="">-- è¯·é€‰æ‹©ä¸€å¼ SSRå¡ç‰‡ --</option>
                <!-- SSRé€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </select>
            
            <div class="selected-ssr-preview" id="selected-ssr-preview">
                <div class="selected-ssr-card" id="selected-ssr-card">
                    <!-- å¡ç‰‡é¢„è§ˆå†…å®¹ -->
                </div>
                <div class="selected-ssr-name" id="selected-ssr-name"></div>
            </div>
        </div>
    </div>
    
    <!-- æŠ½å¡åŒºåŸŸ -->
    <div class="gacha-section">
        <h2>æŠ½å¡</h2>
        <p>å½“å‰å¡æ± : <span id="current-pool-name">åäºŒç”Ÿè‚–</span></p>
        
        <div class="gacha-buttons">
            <button class="gacha-btn" onclick="drawCard(1)">
                <span>å•æŠ½</span>
                <span class="gacha-cost">(50é‡‘å¸)</span>
            </button>
            <button class="gacha-btn" onclick="drawCard(10)">
                <span>åè¿æŠ½</span>
                <span class="gacha-cost">(450é‡‘å¸)</span>
            </button>
            <button class="gacha-btn" id="flip-game-btn" onclick="openFlipGameModal()" style="display: none;">
                <span>ç¿»ç‰Œæ¸¸æˆ</span>
                <span class="gacha-cost">(50é‡‘å¸/æ¬¡)</span>
            </button>
        </div>
        
        <div class="pity-counter">
            <div>SSRä¿åº•è®¡æ•°: <span id="ssr-pity">0</span>/80 (80æŠ½å¿…å¾—SSR)</div>
            <div>SRä¿åº•è®¡æ•°: <span id="sr-pity">0</span>/10 (10æŠ½å¿…å¾—SRæˆ–ä»¥ä¸Š)</div>
        </div>
    </div>
    
    <!-- æŠ½å¡ç»“æœå¼¹çª— -->
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æŠ½å¡ç»“æœ</h3>
                <button class="close-modal" onclick="closeResultModal()">&times;</button>
            </div>
            <div id="result-container">
                <!-- æŠ½å¡ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button class="gacha-btn" onclick="closeResultModal()" style="margin-top: 20px;">ç¡®å®š</button>
        </div>
    </div>
    
    <!-- å¡å†Œå¼¹çª— -->
    <div class="modal" id="album-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æˆ‘çš„å¡å†Œ</h3>
                <button class="close-modal" onclick="closeAlbumModal()">&times;</button>
            </div>
            <div class="album-tabs" id="album-tabs">
                <!-- å¡å†Œæ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="album-grid" id="album-grid">
                <!-- å¡å†Œå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- ç¢ç‰‡å•†åº—å¼¹çª— -->
    <div class="modal" id="shop-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç¢ç‰‡å•†åº— <span id="modal-fragments-count">(0ç¢ç‰‡)</span></h3>
                <button class="close-modal" onclick="closeShopModal()">&times;</button>
            </div>
            <div id="shop-items">
                <!-- å•†åº—ç‰©å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- ç§¯åˆ†å…‘æ¢å¼¹çª— -->
    <div class="modal" id="exchange-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç§¯åˆ†å…‘æ¢é‡‘å¸</h3>
                <button class="close-modal" onclick="closeExchangeModal()">&times;</button>
            </div>
            <div class="exchange-form">
                <div class="exchange-form-group">
                    <label for="modal-exchange-points">å…‘æ¢ç§¯åˆ†</label>
                    <input type="number" id="modal-exchange-points" placeholder="è¾“å…¥ç§¯åˆ†æ•°é‡" min="1">
                    <p class="info-text">å½“å‰å…‘æ¢ç‡: 1ç§¯åˆ† = <span id="modal-exchange-rate">10</span>é‡‘å¸</p>
                </div>
                <div class="exchange-form-group">
                    <label>å¯è·å¾—é‡‘å¸</label>
                    <input type="text" id="modal-exchange-result" placeholder="0" readonly>
                </div>
                <button class="exchange-submit" onclick="modalExchangePoints()">ç¡®è®¤å…‘æ¢</button>
            </div>
        </div>
    </div>
    
    <!-- ç¿»ç‰Œæ¸¸æˆå¼¹çª— -->
    <div class="modal" id="flip-game-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ä¸‰ä¸½é¸¥ç¿»ç‰Œæ¸¸æˆ</h3>
                <button class="close-modal" onclick="closeFlipGameModal()">&times;</button>
            </div>
            <div id="flip-game-container" class="flip-game-container">
                <!-- ç¿»ç‰Œæ¸¸æˆå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <button class="home-btn" onclick="window.location.href='lottery.html'">ğŸ’°</button>
    <!-- å¡å†ŒæŒ‰é’® -->
    <button class="album-btn" onclick="openAlbumModal()">ğŸ“”</button>
    <button class="shop-btn" onclick="openShopModal()">ğŸ›ï¸</button>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-btn" onclick="toggleThemeOptions()">ğŸ¨</button>
    <div class="theme-options" id="theme-options">
        <button class="theme-option default" onclick="changeTheme('default')"></button>
        <button class="theme-option pink" onclick="changeTheme('pink')"></button>
        <button class="theme-option blue" onclick="changeTheme('blue')"></button>
        <button class="theme-option yellow" onclick="changeTheme('yellow')">â˜€</button>
        <button class="theme-option dark" onclick="changeTheme('dark')"></button>
        <button class="theme-option sanrio" onclick="tryChangeToSanrioTheme()">ğŸ€</button>
    </div>
    
    <script>
        // åˆå§‹åŒ–æ•°æ®
        let coins = localStorage.getItem('userCoins') ? parseInt(localStorage.getItem('userCoins')) : 5000;
        let fragments = localStorage.getItem('userFragments') ? parseInt(localStorage.getItem('userFragments')) : 25;
        let collectedCards = localStorage.getItem('collectedCards') ? JSON.parse(localStorage.getItem('collectedCards')) : {};
        let pityCounters = localStorage.getItem('pityCounters') ? JSON.parse(localStorage.getItem('pityCounters')) : {
            ssr: 0,
            sr: 0
        };
        let selectedSSR = localStorage.getItem('selectedSSR') || null;
        let currentPool = localStorage.getItem('currentPool') || 'zodiac';
        let isSanrioUnlocked = localStorage.getItem('isSanrioUnlocked') === 'true';
        const exchangeRate = 10; // 1ç§¯åˆ† = 10é‡‘å¸
        
        // ç¿»ç‰Œæ¸¸æˆçŠ¶æ€
        let flipGameState = localStorage.getItem('flipGameState') ? JSON.parse(localStorage.getItem('flipGameState')) : null;
        
        // å¡æ± é…ç½® - æ•´åˆå››å­£é™å®šä¸ºä¸€ä¸ªæ± å­
        const cardPools = {
            zodiac: {
               name: "ç¥å…½ç”Ÿè‚–",
               ssr: [
                  {
                       id: "beast-ssr-1",
                       name: "é’é¾™",
                       rarity: "SSR",
                       image: "images/cards/animal/ssr-animal1.jpg"
                   },
                   {
                      id: "beast-ssr-2",
                      name: "ç™½è™",
                      rarity: "SSR",
                      image: "images/cards/animal/ssr-animal2.jpg"
                    },
                    {
                      id: "beast-ssr-3",
                      name: "æœ±é›€",
                      rarity: "SSR",
                      image: "images/cards/animal/ssr-animal3.jpg"
                   },
                   {
                      id: "beast-ssr-4",
                      name: "ç„æ­¦",
                      rarity: "SSR",
                      image: "images/cards/animal/ssr-animal4.jpg"
                }
             ],
            sr: [
          // åäºŒç”Ÿè‚–
                { id: "zodiac-sr-1", name: "å­é¼ ", rarity: "SR", image: "images/cards/animal/sr-animal1.jpg" },
                { id: "zodiac-sr-2", name: "ä¸‘ç‰›", rarity: "SR", image: "images/cards/animal/sr-animal2.jpg" },
                { id: "zodiac-sr-3", name: "å¯…è™", rarity: "SR", image: "images/cards/animal/sr-animal3.jpg" },
                { id: "zodiac-sr-4", name: "å¯å…”", rarity: "SR", image: "images/cards/animal/sr-animal4.jpg" },
                { id: "zodiac-sr-5", name: "è¾°é¾™", rarity: "SR", image: "images/cards/animal/sr-animal5.jpg" },
                { id: "zodiac-sr-6", name: "å·³è›‡", rarity: "SR", image: "images/cards/animal/sr-animal6.jpg" },
                { id: "zodiac-sr-7", name: "åˆé©¬", rarity: "SR", image: "images/cards/animal/sr-animal7.jpg" },
                { id: "zodiac-sr-8", name: "æœªç¾Š", rarity: "SR", image: "images/cards/animal/sr-animal8.jpg" },
                { id: "zodiac-sr-9", name: "ç”³çŒ´", rarity: "SR", image: "images/cards/animal/sr-animal9.jpg" },
                { id: "zodiac-sr-10", name: "é…‰é¸¡", rarity: "SR", image: "images/cards/animal/sr-animal10.jpg" },
                { id: "zodiac-sr-11", name: "æˆŒç‹—", rarity: "SR", image: "images/cards/animal/sr-animal11.jpg" },
                { id: "zodiac-sr-12", name: "äº¥çŒª", rarity: "SR", image: "images/cards/animal/sr-animal12.jpg" },
                { id: "zodiac-sr-11", name: "çŒ«", rarity: "SR", image: "images/cards/animal/sr-animal13.jpg" }
                
                ],
            r: Array.from({length: 48}, (_, i) => {
          // å¸¸è§åŠ¨ç‰©åç§°æ•°ç»„ï¼ˆç¤ºä¾‹ï¼‰
             const animals = [
                "ç†ŠçŒ«", "ç‹®å­", "å¤§è±¡", "é•¿é¢ˆé¹¿", "æ–‘é©¬", "çŠ€ç‰›", 
                "çŒè±¹", "ç‹¼", "ç‹ç‹¸", "ç†Š", "é¹¿", "æ²³é©¬",
                "è¢‹é¼ ", "è€ƒæ‹‰", "ä¼é¹…", "æµ·è±š", "é²¨é±¼", "è€é¹°",
                "çŒ«å¤´é¹°", "å­”é›€", "é¹¦é¹‰", "é’è›™", "ä¹Œé¾Ÿ", "èœ¥èœ´",
                "é³„é±¼", "çŒ©çŒ©", "æ¾é¼ ", "åˆºçŒ¬", "é¸­å­", "éª†é©¼",
                "ç¾šç¾Š", "æ°´ç‰›", "çŠ€é¸Ÿ", "å¤©é¹…", "é¹¤", "ä¿¡å¤©ç¿",
                "ç« é±¼", "æ°´æ¯", "æµ·æ˜Ÿ", "èƒèŸ¹", "é¾™è™¾", "è´è¶",
                "èœœèœ‚", "èœ»èœ“", "èœ˜è››", "èå­", "å˜è‰²é¾™", "ç©¿å±±ç”²"
                 ];
        
                    return {
                    id: `animal-r-${i+1}`,
                    name: animals[i] || `åŠ¨ç‰©${i+1}`,
                    rarity: "R",
                    image: `images/cards/animal/r-animal-${i + 1}.jpg`
                 };
              })
            },
            constellation: {
                name: "åäºŒæ˜Ÿåº§",
                ssr: [
                    { id: "constellation-ssr-1", name: "ç™½ç¾Šåº§", rarity: "SSR", image: "images/cards/star/ssr-aries.jpg" },
                    { id: "constellation-ssr-2", name: "é‡‘ç‰›åº§", rarity: "SSR", image: "images/cards/star/ssr-taurus.jpg" },
                    { id: "constellation-ssr-3", name: "åŒå­åº§", rarity: "SSR", image: "images/cards/star/ssr-gemini.jpg" },
                    { id: "constellation-ssr-4", name: "å·¨èŸ¹åº§", rarity: "SSR", image: "images/cards/star/ssr-cancer.jpg" },
                    { id: "constellation-ssr-5", name: "ç‹®å­åº§", rarity: "SSR", image: "images/cards/star/ssr-leo.jpg" },
                    { id: "constellation-ssr-6", name: "å¤„å¥³åº§", rarity: "SSR", image: "images/cards/star/ssr-virgo.jpg" },
                    { id: "constellation-ssr-7", name: "å¤©ç§¤åº§", rarity: "SSR", image: "images/cards/star/ssr-libra.jpg" },
                    { id: "constellation-ssr-8", name: "å¤©èåº§", rarity: "SSR", image: "images/cards/star/ssr-scorpio.jpg" },
                    { id: "constellation-ssr-9", name: "å°„æ‰‹åº§", rarity: "SSR", image: "images/cards/star/ssr-sagittarius.jpg" },
                    { id: "constellation-ssr-10", name: "æ‘©ç¾¯åº§", rarity: "SSR", image: "images/cards/star/ssr-capricorn.jpg" },
                    { id: "constellation-ssr-11", name: "æ°´ç“¶åº§", rarity: "SSR", image: "images/cards/star/ssr-aquarius.jpg" },
                    { id: "constellation-ssr-12", name: "åŒé±¼åº§", rarity: "SSR", image: "images/cards/star/ssr-pisces.jpg" }
                ],
                sr: [
                    { id: "constellation-sr-1", name: "å¤ªé˜³", rarity: "SR", image: "images/cards/star/sr-sun.jpg" },
                    { id: "constellation-sr-2", name: "æ°´æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-mercury.jpg" },
                    { id: "constellation-sr-3", name: "é‡‘æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-venus.jpg" },
                    { id: "constellation-sr-4", name: "åœ°çƒ", rarity: "SR", image: "images/cards/star/sr-earth.jpg" },
                    { id: "constellation-sr-5", name: "æœˆçƒ", rarity: "SR", image: "images/cards/star/sr-moon.jpg" },
                    { id: "constellation-sr-6", name: "ç«æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-mars.jpg" },
                    { id: "constellation-sr-7", name: "æœ¨æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-jupiter.jpg" },
                    { id: "constellation-sr-8", name: "åœŸæ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-saturn.jpg" },
                    { id: "constellation-sr-9", name: "å¤©ç‹æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-uranus.jpg" },
                    { id: "constellation-sr-10", name: "æµ·ç‹æ˜Ÿ", rarity: "SR", image: "images/cards/star/sr-neptune.jpg" }
                ],
                r: Array.from({length: 76}, (_, i) => {
        // ç°ä»£æ˜Ÿåº§åç§°æ•°ç»„ï¼ˆç¤ºä¾‹ï¼‰
        const modernConstellations = [
            "ä»™å¥³åº§", "å”§ç­’åº§", "å¤©ç‡•åº§", "å®ç“¶åº§", "å¤©é¹°åº§", "å¤©å›åº§",
            "ç™½ç¾Šåº§", "å¾¡å¤«åº§", "ç‰§å¤«åº§", "é›•å…·åº§", "é¹¿è±¹åº§", "å·¨èŸ¹åº§",
            "çŒçŠ¬åº§", "å¤§çŠ¬åº§", "å°çŠ¬åº§", "æ‘©ç¾¯åº§", "èˆ¹åº•åº§", "ä»™ååº§",
            "åŠäººé©¬åº§", "ä»™ç‹åº§", "é²¸é±¼åº§", "å °èœ“åº§", "åœ†è§„åº§", "å¤©é¸½åº§",
            "åå‘åº§", "å—å†•åº§", "åŒ—å†•åº§", "ä¹Œé¸¦åº§", "å·¨çˆµåº§", "å—åå­—åº§",
            "å¤©é¹…åº§", "æµ·è±šåº§", "å‰‘é±¼åº§", "å¤©é¾™åº§", "å°é©¬åº§", "æ³¢æ±Ÿåº§",
            "å¤©ç‚‰åº§", "åŒå­åº§", "å¤©é¹¤åº§", "æ­¦ä»™åº§", "æ—¶é’Ÿåº§", "é•¿è›‡åº§",
            "æ°´è›‡åº§", "å°ç¬¬å®‰åº§", "èè™åº§", "ç‹®å­åº§", "å°ç‹®åº§", "å¤©å…”åº§",
            "å¤©ç§¤åº§", "è±ºç‹¼åº§", "å¤©çŒ«åº§", "å¤©ç´åº§", "å±±æ¡ˆåº§", "æ˜¾å¾®é•œåº§",
            "éº’éºŸåº§", "è‹è‡åº§", "çŸ©å°ºåº§", "å—æåº§", "è›‡å¤«åº§", "çŒæˆ·åº§",
            "å­”é›€åº§", "é£é©¬åº§", "è‹±ä»™åº§", "å‡¤å‡°åº§", "ç»˜æ¶åº§", "åŒé±¼åº§",
            "å—é±¼åº§", "èˆ¹å°¾åº§", "ç½—ç›˜åº§", "ç½‘ç½Ÿåº§", "å¤©ç®­åº§", "äººé©¬åº§",
            "å¤©èåº§", "ç‰å¤«åº§", "ç›¾ç‰Œåº§", "å·¨è›‡åº§", "å…­åˆ†ä»ªåº§", "é‡‘ç‰›åº§",
            "æœ›è¿œé•œåº§", "ä¸‰è§’åº§", "å—ä¸‰è§’åº§", "æœé¹ƒåº§", "å¤§ç†Šåº§", "å°ç†Šåº§",
            "èˆ¹å¸†åº§", "å®¤å¥³åº§", "é£é±¼åº§", "ç‹ç‹¸åº§"
        ];
        
                    return {
                        id: `constellation-r-${i+1}`,
                        name: modernConstellations[i] || `æ˜Ÿåº§${i+1}`,
                        rarity: "R",
                        image: `images/cards/star/r-constellation-${i+1}.jpg`
                    };
                })
            },
            

            seasons: {
                name: "å››å­£é™å®š",
                ssr: [
                        {
                        id: `season-ssr-spring`, 
                        name: `æ˜¥`, 
                        rarity: 'SSR',
                        image: "images/cards/seasons/ssr-spring.jpg"
                        },
                    {
                        id: `season-ssr-summer`, 
                        name: `å¤`, 
                        rarity: 'SSR',
                        image: "images/cards/seasons/ssr-summer.jpg"
                    },
                    {
                        id: `season-ssr-autumn`, 
                        name: `ç§‹`, 
                        rarity: 'SSR',
                        image: "images/cards/seasons/ssr-autumn.jpg"
                    },
                    {
                        id: `season-ssr-winter`, 
                        name: `å†¬`, 
                        rarity: 'SSR',
                        image:  "images/cards/seasons/ssr-winter.jpg"
                    }
                ],
 
            sr: [
            // æ˜¥å­£èŠ‚æ°”ï¼ˆ6å¼ ï¼‰
            { id: "sr-spring-1", name: "ç«‹æ˜¥", rarity: "SR", image: "images/cards/seasons/sr-spring-1.jpg" },
            { id: "sr-spring-2", name: "é›¨æ°´", rarity: "SR", image: "images/cards/seasons/sr-spring-2.jpg" },
            { id: "sr-spring-3", name: "æƒŠè›°", rarity: "SR", image: "images/cards/seasons/sr-spring-3.jpg" },
            { id: "sr-spring-4", name: "æ˜¥åˆ†", rarity: "SR", image: "images/cards/seasons/sr-spring-4.jpg" },
            { id: "sr-spring-5", name: "æ¸…æ˜", rarity: "SR", image: "images/cards/seasons/sr-spring-5.jpg" },
            { id: "sr-spring-6", name: "è°·é›¨", rarity: "SR", image: "images/cards/seasons/sr-spring-6.jpg" },
            
            // å¤å­£èŠ‚æ°”ï¼ˆ6å¼ ï¼‰
            { id: "sr-summer-1", name: "ç«‹å¤", rarity: "SR", image: "images/cards/seasons/sr-summer-1.jpg" },
            { id: "sr-summer-2", name: "å°æ»¡", rarity: "SR", image: "images/cards/seasons/sr-summer-2.jpg" },
            { id: "sr-summer-3", name: "èŠ’ç§", rarity: "SR", image: "images/cards/seasons/sr-summer-3.jpg" },
            { id: "sr-summer-4", name: "å¤è‡³", rarity: "SR", image: "images/cards/seasons/sr-summer-4.jpg" },
            { id: "sr-summer-5", name: "å°æš‘", rarity: "SR", image: "images/cards/seasons/sr-summer-5.jpg" },
            { id: "sr-summer-6", name: "å¤§æš‘", rarity: "SR", image: "images/cards/seasons/sr-summer-6.jpg" },
            
            // ç§‹å­£èŠ‚æ°”ï¼ˆ6å¼ ï¼‰
            { id: "sr-autumn-1", name: "ç«‹ç§‹", rarity: "SR", image: "images/cards/seasons/sr-autumn-1.jpg" },
            { id: "sr-autumn-2", name: "å¤„æš‘", rarity: "SR", image: "images/cards/seasons/sr-autumn-2.jpg" },
            { id: "sr-autumn-3", name: "ç™½éœ²", rarity: "SR", image: "images/cards/seasons/sr-autumn-3.jpg" },
            { id: "sr-autumn-4", name: "ç§‹åˆ†", rarity: "SR", image: "images/cards/seasons/sr-autumn-4.jpg" },
            { id: "sr-autumn-5", name: "å¯’éœ²", rarity: "SR", image: "images/cards/seasons/sr-autumn-5.jpg" },
            { id: "sr-autumn-6", name: "éœœé™", rarity: "SR", image: "images/cards/seasons/sr-autumn-6.jpg" },
            
            // å†¬å­£èŠ‚æ°”ï¼ˆ6å¼ ï¼‰
            { id: "sr-winter-1", name: "ç«‹å†¬", rarity: "SR", image: "images/cards/seasons/sr-winter-1.jpg" },
            { id: "sr-winter-2", name: "å°é›ª", rarity: "SR", image: "images/cards/seasons/sr-winter-2.jpg" },
            { id: "sr-winter-3", name: "å¤§é›ª", rarity: "SR", image: "images/cards/seasons/sr-winter-3.jpg" },
            { id: "sr-winter-4", name: "å†¬è‡³", rarity: "SR", image: "images/cards/seasons/sr-winter-4.jpg" },
            { id: "sr-winter-5", name: "å°å¯’", rarity: "SR", image: "images/cards/seasons/sr-winter-5.jpg" },
            { id: "sr-winter-6", name: "å¤§å¯’", rarity: "SR", image: "images/cards/seasons/sr-winter-6.jpg" }
             ],
            r: Array.from({length: 72}, (_, i) => ({
            id: `season-r-${i+1}`,
            name: `å››å­£${i+1}`,
            rarity: "R",
            image: `images/cards/seasons/r-seasons-${i+1}.jpg`
            }))
            },
            
            // ä¸‰ä¸½é¸¥å¡æ± 
            sanrio: {
                name: "ä¸‰ä¸½é¸¥",
                ssr: Array.from({length: 27}, (_, i) => ({
                    id: `sanrio-ssr-${i+1}`,
                    name: `ä¸‰ä¸½é¸¥è§’è‰²${i+1}`,
                    rarity: "SSR",
                    image: `images/cards/sanrio/ssr-sanrio-${i+1}.jpg`
                })),
                sr: [],
                r: []
            }
        };
        
        // ç‰¹æ®ŠSPå¡ç‰‡(å¡”ç½—ç‰Œ)
        const spCards = Array.from({length: 22}, (_, i) => ({
            id: `sp-${i+1}`,
            name: `å¡”ç½—ç‰Œ${i+1}`,
            rarity: 'SP',
            image: `images/cards/sp/sp-${i+1}.jpg`,
            cost: 188, // æ¯ä¸ªSPå¡éœ€è¦100ç¢ç‰‡
            description: `å¤§é˜¿å¡é‚£ç¬¬${i+1}å·`  
        }));
        
        // ç¿»ç‰Œæ¸¸æˆå¥–åŠ±é…ç½®
        const flipGameRewards = {
            // æ¯å±‚çš„å¥–åŠ±é…ç½®
            levels: [
                { // ç¬¬1å±‚
                    fragments: [1, 2, 3],
                    nextLevelKey: "level2_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬2å±‚
                    fragments: [1, 2, 3],
                    nextLevelKey: "level3_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬3å±‚
                    fragments: [2, 3, 4],
                    nextLevelKey: "level4_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬4å±‚
                    fragments: [2, 3, 4],
                    nextLevelKey: "level5_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬5å±‚
                    fragments: [3, 4, 5],
                    nextLevelKey: "level6_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬6å±‚
                    fragments: [3, 4, 5],
                    nextLevelKey: "level7_key",
                    nextLevelKeyCount: 1
                },
                { // ç¬¬7å±‚
                    fragments: [3, 4, 5],
                    nextLevelKey: null, // æœ€åä¸€å±‚æ²¡æœ‰ä¸‹ä¸€å±‚é’¥åŒ™
                    nextLevelKeyCount: 0
                }
            ],
            // ç©ºå¥–æ¦‚ç‡
            emptyChance: 0.7
        };
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            document.body.className = `theme-${savedTheme}`;
            
            updateCoinsDisplay();
            updateFragmentsDisplay();
            renderSSRSelection();
            updatePityCounters();
            document.getElementById('current-pool-name').textContent = cardPools[currentPool].name;
            document.getElementById('modal-exchange-rate').textContent = exchangeRate;
            
            // ç›‘å¬ç§¯åˆ†è¾“å…¥å˜åŒ–
            document.getElementById('modal-exchange-points').addEventListener('input', function() {
                updateExchangeResult();
            });
            
            // å¦‚æœæœ‰é€‰ä¸­çš„SSRï¼Œæ˜¾ç¤ºé¢„è§ˆ
            if (selectedSSR) {
                const card = getAllSSRCards().find(c => c.id === selectedSSR);
                if (card) {
                    showSSRPreview(card);
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºç¿»ç‰Œæ¸¸æˆæŒ‰é’®
            updateFlipGameButton();
            
            // æ›´æ–°ä¸‰ä¸½é¸¥æ ‡ç­¾çŠ¶æ€
            updateSanrioTab();
        });
        
        // åˆ‡æ¢ä¸»é¢˜
        function changeTheme(theme) {
            if (theme === 'sanrio' && !isSanrioUnlocked) {
                tryChangeToSanrioTheme();
                return;
            }
            
            document.body.className = `theme-${theme}`;
            localStorage.setItem('selectedTheme', theme);
            closeThemeOptions();
        }
        
        // å°è¯•åˆ‡æ¢åˆ°ä¸‰ä¸½é¸¥ä¸»é¢˜
        function tryChangeToSanrioTheme() {
            if (isSanrioUnlocked) {
                changeTheme('sanrio');
                return;
            }
            
            if (confirm('è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜éœ€è¦88ç¢ç‰‡ï¼Œæ˜¯å¦ç¡®è®¤è§£é”ï¼Ÿ')) {
                if (fragments >= 88) {
                    fragments -= 88;
                    isSanrioUnlocked = true;
                    localStorage.setItem('userFragments', fragments);
                    localStorage.setItem('isSanrioUnlocked', 'true');
                    updateFragmentsDisplay();
                    changeTheme('sanrio');
                    updateSanrioTab();
                    alert('ä¸‰ä¸½é¸¥ä¸»é¢˜å·²è§£é”ï¼');
                } else {
                    alert('ç¢ç‰‡ä¸è¶³ï¼éœ€è¦88ç¢ç‰‡è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜ã€‚');
                }
            }
        }
        
        // å°è¯•åˆ‡æ¢åˆ°ä¸‰ä¸½é¸¥å¡æ± 
        function trySwitchToSanrio() {
            if (isSanrioUnlocked) {
                switchPool('sanrio');
                return;
            }
            
            if (confirm('è§£é”ä¸‰ä¸½é¸¥å¡æ± éœ€è¦88ç¢ç‰‡ï¼Œæ˜¯å¦ç¡®è®¤è§£é”ï¼Ÿ')) {
                if (fragments >= 88) {
                    fragments -= 88;
                    isSanrioUnlocked = true;
                    localStorage.setItem('userFragments', fragments);
                    localStorage.setItem('isSanrioUnlocked', 'true');
                    updateFragmentsDisplay();
                    switchPool('sanrio');
                    updateSanrioTab();
                    alert('ä¸‰ä¸½é¸¥å¡æ± å·²è§£é”ï¼');
                } else {
                    alert('ç¢ç‰‡ä¸è¶³ï¼éœ€è¦88ç¢ç‰‡è§£é”ä¸‰ä¸½é¸¥å¡æ± ã€‚');
                }
            }
        }
        
        // æ›´æ–°ä¸‰ä¸½é¸¥æ ‡ç­¾çŠ¶æ€
        function updateSanrioTab() {
            const sanrioTab = document.getElementById('sanrio-tab');
            if (!sanrioTab) return;
            
            if (!isSanrioUnlocked) {
                sanrioTab.classList.add('sanrio-lock');
            } else {
                sanrioTab.classList.remove('sanrio-lock');
            }
        }
        
        // æ˜¾ç¤º/éšè—ä¸»é¢˜é€‰é¡¹
        function toggleThemeOptions() {
            const options = document.getElementById('theme-options');
            if (options.style.display === 'flex') {
                options.style.display = 'none';
            } else {
                options.style.display = 'flex';
            }
        }
        
        // å…³é—­ä¸»é¢˜é€‰é¡¹
        function closeThemeOptions() {
            document.getElementById('theme-options').style.display = 'none';
        }
        
        // è·å–å½“å‰å¡æ± çš„æ‰€æœ‰SSRå¡ç‰‡
        function getAllSSRCards() {
            return cardPools[currentPool].ssr;
        }
        
        // æ›´æ–°é‡‘å¸æ˜¾ç¤º
        function updateCoinsDisplay() {
            document.getElementById('current-coins').textContent = coins;
            localStorage.setItem('userCoins', coins);
        }
        
        // æ›´æ–°ç¢ç‰‡æ˜¾ç¤º
        function updateFragmentsDisplay() {
            try {
                fragments = parseInt(localStorage.getItem('userFragments')) || 0;
                const counter = document.getElementById('modal-fragments-count');
                if (counter) {
                    counter.textContent = `(${fragments}ç¢ç‰‡)`;
                }
            } catch (e) {
                console.error("æ›´æ–°ç¢ç‰‡æ˜¾ç¤ºå¤±è´¥:", e);
            }
        }
        
        // æ›´æ–°ä¿åº•è®¡æ•°å™¨æ˜¾ç¤º
        function updatePityCounters() {
            document.getElementById('ssr-pity').textContent = pityCounters.ssr;
            document.getElementById('sr-pity').textContent = pityCounters.sr;
            localStorage.setItem('pityCounters', JSON.stringify(pityCounters));
        }
        
        // åˆ‡æ¢å¡æ± 
        function switchPool(poolId) {
            // æ›´æ–°å¡æ± æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.pool-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentPool = poolId;
            localStorage.setItem('currentPool', currentPool);
            document.getElementById('current-pool-name').textContent = cardPools[currentPool].name;
            
            // é‡ç½®é€‰ä¸­çš„SSR
            selectedSSR = null;
            localStorage.removeItem('selectedSSR');
            renderSSRSelection();
            document.getElementById('selected-ssr-preview').style.display = 'none';
            
            // æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºç¿»ç‰Œæ¸¸æˆæŒ‰é’®
            updateFlipGameButton();
        }
        
        // æ›´æ–°ç¿»ç‰Œæ¸¸æˆæŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        function updateFlipGameButton() {
            const flipGameBtn = document.getElementById('flip-game-btn');
            const gachaBtns = document.querySelectorAll('.gacha-buttons button:not(#flip-game-btn)');
            
            if (currentPool === 'sanrio') {
                flipGameBtn.style.display = 'flex';
                // éšè—å•æŠ½å’Œåè¿æŒ‰é’®
                gachaBtns.forEach(btn => {
                    btn.style.display = 'none';
                });
            } else {
                flipGameBtn.style.display = 'none';
                // æ˜¾ç¤ºå•æŠ½å’Œåè¿æŒ‰é’®
                gachaBtns.forEach(btn => {
                    btn.style.display = 'flex';
                });
            }
        }
        
        // æ¸²æŸ“SSRé€‰æ‹©ä¸‹æ‹‰èœå•
        function renderSSRSelection() {
            const select = document.getElementById('ssr-select');
            select.innerHTML = '';
            
            // æ·»åŠ é»˜è®¤é€‰é¡¹
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '-- è¯·é€‰æ‹©ä¸€å¼ SSRå¡ç‰‡ --';
            select.appendChild(defaultOption);
            
            // æ·»åŠ SSRå¡ç‰‡é€‰é¡¹
            const pool = cardPools[currentPool];
            pool.ssr.forEach(card => {
                const option = document.createElement('option');
                option.value = card.id;
                option.textContent = card.name;
                select.appendChild(option);
            });
            
            // è®¾ç½®å·²é€‰ä¸­çš„SSR
            if (selectedSSR) {
                select.value = selectedSSR;
            }
        }
        
        // é€‰æ‹©SSRå¡ç‰‡
        function selectSSR(cardId) {
            if (!cardId) {
                selectedSSR = null;
                localStorage.removeItem('selectedSSR');
                document.getElementById('selected-ssr-preview').style.display = 'none';
                return;
            }
            
            selectedSSR = cardId;
            localStorage.setItem('selectedSSR', selectedSSR);
            
            // æ˜¾ç¤ºé€‰ä¸­çš„SSRé¢„è§ˆ
            const card = getAllSSRCards().find(c => c.id === cardId);
            if (card) {
                showSSRPreview(card);
            }
        }
        
        // æ˜¾ç¤ºSSRå¡ç‰‡é¢„è§ˆ
        function showSSRPreview(card) {
            const preview = document.getElementById('selected-ssr-preview');
            const cardElement = document.getElementById('selected-ssr-card');
            const nameElement = document.getElementById('selected-ssr-name');
            
            cardElement.innerHTML = `<img src="${card.image}" alt="${card.name}">`;
            nameElement.textContent = card.name;
            
            preview.style.display = 'block';
        }
        
        function drawCard(count) {
            if (!selectedSSR) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ SSRå¡ç‰‡ä½œä¸ºç›®æ ‡!');
                return;
            }

            const cost = count === 1 ? 50 : 450;
            if (coins < cost) {
                alert('é‡‘å¸ä¸è¶³!');
                return;
            }

            coins -= cost;
            updateCoinsDisplay();

            const results = [];
            let gotSSR = false;
            let gotSR = false;

            // SRæ¦‚ç‡é€’å¢è¡¨ï¼ˆä»ç¬¬0æ¬¡å¼€å§‹è®¡æ•°ï¼‰
            const srProbabilityTable = [
                5.4,   // ç¬¬1æ¬¡(ç´¢å¼•0)
                9.9,   // ç¬¬2æ¬¡
                14.5,  // ç¬¬3æ¬¡
                18.8,  // ç¬¬4æ¬¡
                23.1,  // ç¬¬5æ¬¡
                26.9,  // ç¬¬6æ¬¡
                30.6,  // ç¬¬7æ¬¡
                34.2,  // ç¬¬8æ¬¡
                70.1,  // ç¬¬9æ¬¡
                99.6,  // ç¬¬10æ¬¡
                100    // ç¬¬11æ¬¡
            ];

            for (let i = 0; i < count; i++) {
                // 1. å…ˆæ£€æŸ¥SSRä¿åº•(80æŠ½)
                if (pityCounters.ssr >= 79) {
                    results.push(drawSSR());
                    gotSSR = true;
                    pityCounters.ssr = 0;
                    pityCounters.sr = 0; // SSRä¹Ÿä¼šé‡ç½®SRè®¡æ•°å™¨
                    continue;
                }

                // 2. è·å–å½“å‰SRæ¦‚ç‡
                const currentSRChance = srProbabilityTable[Math.min(pityCounters.sr, 10)];
                
                // 3. ç”Ÿæˆéšæœºæ•°å†³å®šæŠ½å¡ç»“æœ
                const rand = Math.random() * 100;
                
                if (rand < 0.6) {
                    // SSR 0.6%
                    results.push(drawSSR());
                    gotSSR = true;
                    pityCounters.ssr = 0;
                    pityCounters.sr = 0; // æŠ½åˆ°SSRä¹Ÿé‡ç½®SRè®¡æ•°å™¨
                } 
                else if (rand < currentSRChance) {
                    // SR åŠ¨æ€æ¦‚ç‡
                    results.push(drawSR());
                    gotSR = true;
                    pityCounters.sr = 0; // é‡ç½®SRè®¡æ•°å™¨
                } 
                else {
                    // Rå¡
                    results.push(drawR());
                    pityCounters.sr++; // å¢åŠ SRè®¡æ•°å™¨
                }

                pityCounters.ssr++; // å¢åŠ SSRè®¡æ•°å™¨
            }

            updatePityCounters();
            addCardsToCollection(results);
            showResults(results);
        }
        
        // æŠ½å–SSRå¡ç‰‡
        function drawSSR() {
            const pool = cardPools[currentPool];
            
            // ç›´æ¥è¿”å›é€‰ä¸­çš„SSRå¡ç‰‡
            const card = pool.ssr.find(c => c.id === selectedSSR);
            
            return {
                ...card,
                isNew: !collectedCards[card.id]
            };
        }
        
        // æŠ½å–SRå¡ç‰‡
        function drawSR() {
            const pool = cardPools[currentPool];
            const card = pool.sr[Math.floor(Math.random() * pool.sr.length)];
            return {
                ...card,
                isNew: !collectedCards[card.id]
            };
        }
        
        // æŠ½å–Rå¡ç‰‡
        function drawR() {
            const pool = cardPools[currentPool];
            const card = pool.r[Math.floor(Math.random() * pool.r.length)];
            return {
                ...card,
                isNew: !collectedCards[card.id]
            };
        }
        
        // æ·»åŠ å¡ç‰‡åˆ°æ”¶è—
        function addCardsToCollection(cards) {
            let newFragments = 0;
            
            cards.forEach(card => {
                if (!collectedCards[card.id]) {
                    collectedCards[card.id] = {
                        id: card.id,
                        name: card.name,
                        rarity: card.rarity,
                        image: card.image,
                        pool: currentPool,
                        collectedAt: new Date().toISOString()
                    };
                } else {
                    // é‡å¤å¡ç‰‡è½¬åŒ–ä¸ºç¢ç‰‡
                    if (card.rarity === 'SSR') {
                        newFragments += 10;
                    } else if (card.rarity === 'SR') {
                        newFragments += 2;
                    } else {
                        // Rå¡è½¬åŒ–ä¸ºç‚¹æ•°ï¼Œ30ç‚¹=1ç¢ç‰‡
                        newFragments += 1/30;
                    }
                }
            });
            
            // æ›´æ–°ç¢ç‰‡(å››èˆäº”å…¥)
            fragments += Math.round(newFragments);
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('collectedCards', JSON.stringify(collectedCards));
            localStorage.setItem('userFragments', fragments);
            
            // æ›´æ–°æ˜¾ç¤º
            updateFragmentsDisplay();
        }
        
        // æ˜¾ç¤ºæŠ½å¡ç»“æœ
        function showResults(results) {
            const container = document.getElementById('result-container');
            container.innerHTML = '';
            
            if (results.length === 1) {
                // å•æŠ½ç»“æœ
                const card = results[0];
                const cardElement = createResultCardElement(card);
                container.appendChild(cardElement);
                
                // æ˜¾ç¤ºæ–°è·å¾—æç¤º
                if (card.isNew) {
                    const newLabel = document.createElement('div');
                    newLabel.textContent = 'æ–°è·å¾—!';
                    newLabel.style.color = '#FF5722';
                    newLabel.style.fontWeight = 'bold';
                    newLabel.style.marginTop = '15px';
                    newLabel.style.fontSize = '18px';
                    container.appendChild(newLabel);
                }
            } else {
                // åè¿ç»“æœ
                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
                grid.style.gap = '15px';
                grid.style.margin = '0 auto';
                
                results.forEach(card => {
                    const cardElement = createResultCardElement(card, true);
                    grid.appendChild(cardElement);
                });
                
                container.appendChild(grid);
                
                // ç»Ÿè®¡ç»“æœ
                const ssrCount = results.filter(c => c.rarity === 'SSR').length;
                const srCount = results.filter(c => c.rarity === 'SR').length;
                const newCount = results.filter(c => c.isNew).length;
                
                const stats = document.createElement('div');
                stats.style.marginTop = '25px';
                stats.style.padding = '15px';
                stats.style.background = 'linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%)';
                stats.style.borderRadius = '12px';
                stats.style.textAlign = 'center';
                stats.style.fontSize = '18px';
                stats.innerHTML = `
                    <p><strong>æŠ½å¡ç»“æœç»Ÿè®¡</strong></p>
                    <p>SSR: ${ssrCount}å¼  | SR: ${srCount}å¼  | æ–°å¡ç‰‡: ${newCount}å¼ </p>
                `;
                container.appendChild(stats);
            }
            
            openResultModal();
        }
        
        // åˆ›å»ºç»“æœå¡ç‰‡å…ƒç´ 
        function createResultCardElement(card, isMulti = false) {
            const cardElement = document.createElement('div');
            cardElement.className = `result-card ${card.rarity.toLowerCase()}`;
            
            if (isMulti) {
                cardElement.style.width = '100%';
                cardElement.style.height = 'auto';
                cardElement.style.margin = '0';
            }
            
            cardElement.innerHTML = `
                <img src="${card.image}" alt="${card.name}">
                <div class="rarity">${card.rarity}</div>
                <div class="card-name">${card.name}</div>
                ${card.isNew ? '<div class="new-badge">NEW</div>' : ''}
            `;
            
            return cardElement;
        }
        
        // æ‰“å¼€å¡å†Œå¼¹çª—
        function openAlbumModal() {
            renderAlbumTabs();
            renderAlbumGrid('all');
            document.getElementById('album-modal').style.display = 'flex';
        }
        
        // å…³é—­å¡å†Œå¼¹çª—
        function closeAlbumModal() {
            document.getElementById('album-modal').style.display = 'none';
        }
        
        // æ¸²æŸ“å¡å†Œæ ‡ç­¾
        function renderAlbumTabs() {
            const tabs = document.getElementById('album-tabs');
            tabs.innerHTML = '';
            
            // å…¨éƒ¨æ ‡ç­¾
            const allTab = document.createElement('div');
            allTab.className = 'album-tab active';
            allTab.textContent = 'å…¨éƒ¨';
            allTab.onclick = () => renderAlbumGrid('all');
            tabs.appendChild(allTab);
            
            // æŒ‰å¡æ± åˆ†ç±»
            Object.keys(cardPools).forEach(poolId => {
                const tab = document.createElement('div');
                tab.className = 'album-tab';
                tab.textContent = cardPools[poolId].name;
                tab.onclick = () => renderAlbumGrid(poolId);
                tabs.appendChild(tab);
            });
            
            // SPå¡ç‰‡æ ‡ç­¾
            const spTab = document.createElement('div');
            spTab.className = 'album-tab';
            spTab.textContent = 'SPå¡ç‰‡';
            spTab.onclick = () => renderAlbumGrid('sp');
            tabs.appendChild(spTab);
        }
        
        // æ¸²æŸ“å¡å†Œå†…å®¹
        function renderAlbumGrid(filter) {
            const grid = document.getElementById('album-grid');
            grid.innerHTML = '';
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('#album-tabs .album-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            let activeTab;
            if (event) {
                event.target.classList.add('active');
                activeTab = event.target;
            } else {
                activeTab = document.querySelector('#album-tabs .album-tab.active');
                if (activeTab) activeTab.classList.add('active');
            }
            
            if (filter === 'all') {
                // æ˜¾ç¤ºæ‰€æœ‰å¡ç‰‡
                Object.keys(cardPools).forEach(poolId => {
                    const pool = cardPools[poolId];
                    [...pool.ssr, ...pool.sr, ...pool.r].forEach(card => {
                        grid.appendChild(createAlbumCardElement(card));
                    });
                });
                
                // æ·»åŠ SPå¡ç‰‡
                spCards.forEach(card => {
                    grid.appendChild(createAlbumCardElement(card));
                });
            } else if (filter === 'sp') {
                // æ˜¾ç¤ºSPå¡ç‰‡
                spCards.forEach(card => {
                    grid.appendChild(createAlbumCardElement(card));
                });
            } else {
                // æ˜¾ç¤ºç‰¹å®šå¡æ± çš„å¡ç‰‡
                const pool = cardPools[filter];
                [...pool.ssr, ...pool.sr, ...pool.r].forEach(card => {
                    grid.appendChild(createAlbumCardElement(card));
                });
            }
        }
        
        // åˆ›å»ºå¡å†Œå¡ç‰‡å…ƒç´ 
        function createAlbumCardElement(card) {
            const cardElement = document.createElement('div');
            cardElement.className = 'album-card';
            if (collectedCards[card.id]) {
                cardElement.classList.add('collected');
            }
            
            cardElement.innerHTML = `
                <div class="card-image-container">
                    ${collectedCards[card.id] ? 
                        `<img src="${card.image}" alt="${card.name}">` : 
                        '<div class="unknown-card">?</div>'
                    }
                </div>
                <div class="card-name">${collectedCards[card.id] ? card.name : 'æœªè·å¾—'}</div>
                <div class="card-rarity">${card.rarity}</div>
            `;
            
            return cardElement;
        }
        
        // è·å–ç¨€æœ‰åº¦é¢œè‰²
        function getRarityColor(rarity) {
            switch (rarity) {
                case 'SSR': return '#FFD700';
                case 'SR': return '#C0C0C0';
                case 'R': return '#CD7F32';
                case 'SP': return '#EE82EE';
                default: return '#f8f8f8';
            }
        }
        
        // æ‰“å¼€ç¢ç‰‡å•†åº—å¼¹çª—
        function openShopModal() {
            updateFragmentsDisplay(); 
            renderShopItems();
            document.getElementById('shop-modal').style.display = 'flex';
        }
        
        // å…³é—­ç¢ç‰‡å•†åº—å¼¹çª—
        function closeShopModal() {
            document.getElementById('shop-modal').style.display = 'none';
        }
        
        // æ¸²æŸ“å•†åº—ç‰©å“
        function renderShopItems() {
            const container = document.getElementById('shop-items');
            container.innerHTML = '';
            
            spCards.forEach(card => {
                const item = document.createElement('div');
                item.className = 'shop-item';
                
                const owned = collectedCards[card.id] ? '<span style="color:#f44336;">(å·²æ‹¥æœ‰)</span>' : '';
                
                item.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-img">
                            <img src="${card.image}" alt="${card.name}">
                        </div>
                        <div class="shop-item-details">
                            <div class="shop-item-name">${card.name} ${owned}</div>
                            <div class="shop-item-desc">${card.description}</div>
                        </div>
                    </div>
                    <div>
                        <span class="shop-item-price">${card.cost}ç¢ç‰‡</span>
                        <button class="shop-item-btn" ${collectedCards[card.id] || fragments < card.cost ? 'disabled' : ''} 
                            onclick="buySPCard('${card.id}')">å…‘æ¢</button>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // æ·»åŠ ä¸‰ä¸½é¸¥è§£é”é€‰é¡¹ï¼ˆå¦‚æœæœªè§£é”ï¼‰
            if (!isSanrioUnlocked) {
                const unlockItem = document.createElement('div');
                unlockItem.className = 'shop-item';
                
                unlockItem.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-img" style="background-color: #FF9DB5;">
                            ğŸ€
                        </div>
                        <div class="shop-item-details">
                            <div class="shop-item-name">è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± </div>
                            <div class="shop-item-desc">è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± ï¼ŒåŒ…å«27å¼ SSRå¡ç‰‡</div>
                        </div>
                    </div>
                    <div>
                        <span class="shop-item-price">88ç¢ç‰‡</span>
                        <button class="shop-item-btn" ${fragments < 88 ? 'disabled' : ''} 
                            onclick="unlockSanrio()">è§£é”</button>
                    </div>
                `;
                
                container.insertBefore(unlockItem, container.firstChild);
            }
        }
        
        // è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± 
        function unlockSanrio() {
            if (isSanrioUnlocked) {
                alert('ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± å·²ç»è§£é”ï¼');
                return;
            }
            
            if (fragments < 88) {
                alert('ç¢ç‰‡ä¸è¶³ï¼éœ€è¦88ç¢ç‰‡è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± ã€‚');
                return;
            }
            
            if (confirm('ç¡®è®¤èŠ±è´¹88ç¢ç‰‡è§£é”ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± å—ï¼Ÿ')) {
                fragments -= 88;
                isSanrioUnlocked = true;
                localStorage.setItem('userFragments', fragments);
                localStorage.setItem('isSanrioUnlocked', 'true');
                updateFragmentsDisplay();
                renderShopItems();
                updateSanrioTab();
                alert('ä¸‰ä¸½é¸¥ä¸»é¢˜å’Œå¡æ± å·²è§£é”ï¼');
            }
        }
        
        // è´­ä¹°SPå¡ç‰‡
        function buySPCard(cardId) {
            const card = spCards.find(c => c.id === cardId);
            if (!card) return;
            
            if (fragments < card.cost) {
                alert('ç¢ç‰‡ä¸è¶³!');
                return;
            }
            
            if (collectedCards[cardId]) {
                alert('å·²ç»æ‹¥æœ‰è¿™å¼ å¡ç‰‡!');
                return;
            }
            
            fragments -= card.cost;
            collectedCards[cardId] = {
                id: card.id,
                name: card.name,
                image: card.image,
                rarity: card.rarity,
                pool: 'sp',
                collectedAt: new Date().toISOString()
            };
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('collectedCards', JSON.stringify(collectedCards));
            localStorage.setItem('userFragments', fragments);
            
            // æ›´æ–°æ˜¾ç¤º
            updateFragmentsDisplay();
            renderShopItems();
            
            alert(`æˆåŠŸå…‘æ¢ ${card.name}!`);
        }
        
        // æ‰“å¼€å…‘æ¢å¼¹çª—
        function openExchangeModal() {
            document.getElementById('exchange-modal').style.display = 'flex';
            document.getElementById('modal-exchange-points').value = '';
            document.getElementById('modal-exchange-result').value = '';
            document.getElementById('modal-exchange-points').focus();
        }
        
        // å…³é—­å…‘æ¢å¼¹çª—
        function closeExchangeModal() {
            document.getElementById('exchange-modal').style.display = 'none';
        }
        
        // æ‰“å¼€ç»“æœå¼¹çª—
        function openResultModal() {
            document.getElementById('result-modal').style.display = 'flex';
        }
        
        // å…³é—­ç»“æœå¼¹çª—
        function closeResultModal() {
            document.getElementById('result-modal').style.display = 'none';
        }
        
        // æ›´æ–°å…‘æ¢ç»“æœé¢„è§ˆ
        function updateExchangeResult() {
            const pointsInput = document.getElementById('modal-exchange-points');
            const points = parseInt(pointsInput.value) || 0;
            const resultInput = document.getElementById('modal-exchange-result');
            resultInput.value = points * exchangeRate;
        }
        
        // å¼¹çª—å†…å…‘æ¢ç§¯åˆ†
        function modalExchangePoints() {
            const pointsInput = document.getElementById('modal-exchange-points');
            const pointsToExchange = parseInt(pointsInput.value);
    
            if (isNaN(pointsToExchange) || pointsToExchange <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡!');
                return;
            }

            // ç›´æ¥ä»localStorageè·å–ç§¯åˆ†æ•°æ®
            const points = localStorage.getItem('userPoints') ? parseInt(localStorage.getItem('userPoints')) : 0;
    
            if (points < pointsToExchange) {
                alert('ç§¯åˆ†ä¸è¶³!');
                return;
            }

            // æ‰§è¡Œå…‘æ¢
            const newPoints = points - pointsToExchange;
            const newCoins = coins + (pointsToExchange * exchangeRate);
            
            // æ›´æ–°æ•°æ®
            localStorage.setItem('userPoints', newPoints);
            localStorage.setItem('userCoins', newCoins);
            
            // æ›´æ–°æ˜¾ç¤º
            coins = newCoins;
            updateCoinsDisplay();
            
            // å…³é—­å¼¹çª—
            closeExchangeModal();
            
            // æç¤ºç”¨æˆ·
            alert(`æˆåŠŸå…‘æ¢ ${pointsToExchange} ç§¯åˆ†ä¸º ${pointsToExchange * exchangeRate} é‡‘å¸!`);
            pointsInput.value = '';
            
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…‘æ¢è®°å½•
            const records = localStorage.getItem('exchangeRecords') ? JSON.parse(localStorage.getItem('exchangeRecords')) : [];
            records.unshift({
                id: Date.now(),
                productName: `å…‘æ¢é‡‘å¸ (${pointsToExchange}ç§¯åˆ†)`,
                pointsUsed: pointsToExchange,
                date: new Date().toLocaleString(),
                userName: localStorage.getItem('userName') || "ç”¨æˆ·"
            });
            localStorage.setItem('exchangeRecords', JSON.stringify(records));
        }
        
        // æ‰“å¼€ç¿»ç‰Œæ¸¸æˆå¼¹çª—
        function openFlipGameModal() {
            if (!selectedSSR) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ ä¸‰ä¸½é¸¥SSRå¡ç‰‡ä½œä¸ºç›®æ ‡!');
                return;
            }
            
            // å¦‚æœæ²¡æœ‰æ¸¸æˆçŠ¶æ€ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ¸¸æˆ
            if (!flipGameState) {
                initFlipGame();
            } else {
                renderFlipGame();
            }
            
            document.getElementById('flip-game-modal').style.display = 'flex';
        }
        
        // å…³é—­ç¿»ç‰Œæ¸¸æˆå¼¹çª—
        function closeFlipGameModal() {
            document.getElementById('flip-game-modal').style.display = 'none';
        }
        
        // åˆå§‹åŒ–ç¿»ç‰Œæ¸¸æˆ
        function initFlipGame() {
            flipGameState = {
                currentLevel: 0,
                revealedCards: [],
                targetCard: selectedSSR,
                fragmentsEarned: 0,
                keys: {}
            };
            
            // ä¿å­˜åˆå§‹çŠ¶æ€
            saveFlipGameState();
            
            // æ¸²æŸ“æ¸¸æˆç•Œé¢
            renderFlipGame();
        }
        
        // ä¿å­˜ç¿»ç‰Œæ¸¸æˆçŠ¶æ€
        function saveFlipGameState() {
            localStorage.setItem('flipGameState', JSON.stringify(flipGameState));
        }
        
        // æ¸²æŸ“ç¿»ç‰Œæ¸¸æˆç•Œé¢
        function renderFlipGame() {
            const container = document.getElementById('flip-game-container');
            container.innerHTML = '';
            
            // æ·»åŠ å…³å¡ä¿¡æ¯
            const levelInfo = document.createElement('div');
            levelInfo.className = 'flip-game-level';
            levelInfo.textContent = `ç¬¬ ${flipGameState.currentLevel + 1} å±‚ (å…± 7 å±‚)`;
            container.appendChild(levelInfo);
            
            // æ·»åŠ æ¸¸æˆç½‘æ ¼
            const grid = document.createElement('div');
            grid.className = 'flip-game-grid';
            
            // åˆ›å»º12å¼ å¡ç‰‡ (3x4)
            for (let i = 0; i < 12; i++) {
                const card = document.createElement('div');
                card.className = 'flip-card';
                
                // æ£€æŸ¥è¿™å¼ ç‰Œæ˜¯å¦å·²ç»è¢«ç¿»å¼€
                if (flipGameState.revealedCards.includes(i)) {
                    card.classList.add('revealed');
                    
                    // è·å–è¿™å¼ ç‰Œçš„å†…å®¹
                    const cardContent = getFlipCardContent(i);
                    card.innerHTML = `
                        <div class="flip-card-content">
                            ${cardContent.image ? `<img src="${cardContent.image}" alt="${cardContent.name}">` : cardContent.name}
                            <div class="flip-card-name">${cardContent.name}</div>
                        </div>
                    `;
                } else {
                    card.textContent = '?';
                    card.onclick = () => flipCard(i);
                }
                
                grid.appendChild(card);
            }
            
            container.appendChild(grid);
            
            // æ·»åŠ æ¸¸æˆä¿¡æ¯
            const gameInfo = document.createElement('div');
            gameInfo.className = 'flip-game-info';
            gameInfo.innerHTML = `
                <span>å·²è·å¾—ç¢ç‰‡: ${flipGameState.fragmentsEarned}</span>
                <span>é‡‘å¸: ${coins}</span>
            `;
            container.appendChild(gameInfo);
            
            // æ·»åŠ ç¿»ç‰ŒæŒ‰é’®
            const flipBtn = document.createElement('button');
            flipBtn.className = 'flip-game-btn';
            flipBtn.textContent = 'ç¿»ç‰Œ (50é‡‘å¸)';
            flipBtn.onclick = () => {
                if (coins >= 50) {
                    // éšæœºç¿»å¼€ä¸€å¼ æœªç¿»å¼€çš„ç‰Œ
                    const unrevealedCards = Array.from({length: 12}, (_, i) => i)
                        .filter(i => !flipGameState.revealedCards.includes(i));
                    
                    if (unrevealedCards.length > 0) {
                        const randomIndex = Math.floor(Math.random() * unrevealedCards.length);
                        flipCard(unrevealedCards[randomIndex]);
                    } else {
                        alert('æ‰€æœ‰ç‰Œéƒ½å·²ç»ç¿»å¼€äº†!');
                    }
                } else {
                    alert('é‡‘å¸ä¸è¶³!');
                }
            };
            container.appendChild(flipBtn);
        }
        
        // è·å–ç¿»ç‰Œæ¸¸æˆå¡ç‰‡å†…å®¹
        function getFlipCardContent(cardIndex) {
            const levelConfig = flipGameRewards.levels[flipGameState.currentLevel];
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä¸‹ä¸€å…³é’¥åŒ™
            if (flipGameState.currentLevel < 6 && cardIndex === 11) {
                return {
                    name: `ç¬¬${flipGameState.currentLevel + 2}å±‚é’¥åŒ™`,
                    image: null
                };
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡å¡ç‰‡ (æœ€åä¸€å±‚)
            if (flipGameState.currentLevel === 6 && cardIndex === 11) {
                const card = cardPools.sanrio.ssr.find(c => c.id === flipGameState.targetCard);
                return {
                    name: card.name,
                    image: card.image
                };
            }
            
            // 30%æ¦‚ç‡æ˜¯ç©ºå¥–
            if (Math.random() < flipGameRewards.emptyChance) {
                return {
                    name: 'ç©ºå¥–',
                    image: null
                };
            }
            
            // å…¶ä»–æƒ…å†µæ˜¯ç¢ç‰‡å¥–åŠ±
            const randomFragments = levelConfig.fragments[Math.floor(Math.random() * levelConfig.fragments.length)];
            return {
                name: `${randomFragments}ç¢ç‰‡`,
                image: null,
                fragments: randomFragments
            };
        }
        
        // ç¿»å¼€ä¸€å¼ ç‰Œ
        function flipCard(cardIndex) {
            if (coins < 50) {
                alert('é‡‘å¸ä¸è¶³!');
                return;
            }
    
            // æ‰£é™¤é‡‘å¸
            coins -= 50;
            updateCoinsDisplay();
    
            // æ ‡è®°è¿™å¼ ç‰Œä¸ºå·²ç¿»å¼€
            flipGameState.revealedCards.push(cardIndex);
    
            // è·å–å¡ç‰‡å†…å®¹
            const cardContent = getFlipCardContent(cardIndex);
    
            // å¤„ç†å¥–åŠ±
            if (cardContent.fragments) {
                // å¢åŠ æ¸¸æˆå†…è·å¾—çš„ç¢ç‰‡æ€»æ•°
                flipGameState.fragmentsEarned += cardContent.fragments;
    
                // å¢åŠ ç©å®¶çš„æ€»ç¢ç‰‡æ•°
                fragments += cardContent.fragments;
    
                // ä¿å­˜ç¢ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('userFragments', fragments.toString());
    
                // æ›´æ–°ç¢ç‰‡æ˜¾ç¤º
                updateFragmentsDisplay();
            }
            
            // ä¿®æ”¹åçš„é’¥åŒ™è·å–é€»è¾‘
            if (flipGameState.currentLevel < 6 && cardIndex === 11) {
                flipGameState.currentLevel++;
                flipGameState.revealedCards = []; // å…³é”®ä¿®å¤ï¼šæ¸…ç©ºç¿»ç‰ŒçŠ¶æ€
                alert(`è·å¾—ç¬¬${flipGameState.currentLevel + 1}å±‚é’¥åŒ™ï¼æ–°å±‚çº§çš„ç‰Œå·²é‡ç½®ï¼`);
                saveFlipGameState();
                renderFlipGame();
                return; // é€€å‡ºå‡½æ•°
            }

            // æœ€ç»ˆå±‚å¥–åŠ±ï¼ˆå¿…é¡»å®é™…ç¿»åˆ°ç¬¬12å¼ ç‰Œï¼‰
            if (flipGameState.currentLevel === 6 && cardIndex === 11) {
                const card = cardPools.sanrio.ssr.find(c => c.id === flipGameState.targetCard);
                addCardsToCollection([{...card, isNew: !collectedCards[card.id]}]);
                alert(`æ­å–œï¼ä½ äº²æ‰‹ç¿»å‡ºäº†ç›®æ ‡å¡ç‰‡ã€${card.name}ã€‘ï¼`);
                flipGameState = null;
                localStorage.removeItem('flipGameState');
            }
    
            // ä¿å­˜æ¸¸æˆçŠ¶æ€
            saveFlipGameState();
    
            // é‡æ–°æ¸²æŸ“æ¸¸æˆç•Œé¢
            renderFlipGame();
        }
    </script>
</body>
</html>
